sap.ui.define([                                                                                                                                                                                                                                                
], function () {                                                                                                                                                                                                                                               
    'use strict';                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return {                                                                                                                                                                                                                                                   
        /*onInit: function (oEvent) {                                                                                                                                                                                                                          
            var msg = 'Teste ABAP.';                                                                                                                                                                                                                           
            sap.m.MessageToast.show(msg);                                                                                                                                                                                                                      
        },*/                                                                                                                                                                                                                                                   
        onInitSmartFilterBarExtension: function (oEvent) {                                                                                                                                                                                                     
            //Get SmartFilterBar&nbsp;                                                                                                                                                                                                                         
            var oGlobalFilter = oEvent.getSource();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            var anoAtual = new Date().getFullYear();                                                                                                                                                                                                           
            var anoUtilizar = new Date().getFullYear();                                                                                                                                                                                                        
            var mesAtual = new Date().getMonth();                                                                                                                                                                                                              
            var mesAnterior = new Date().getMonth() - 1;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            if (mesAtual == 1) {                                                                                                                                                                                                                               
                mesAnterior = 12;                                                                                                                                                                                                                              
                anoUtilizar = anoUtilizar - 1;                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            //Create JSON data that contains the Inital value of the filter                                                                                                                                                                                    
            var lowValue = new Date(anoUtilizar, mesAnterior, 26);                                                                                                                                                                                             
            var highValue = new Date(anoAtual, mesAtual, 25);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var oDefaultFilter = {                                                                                                                                                                                                                             
                "DtApropriacao": {                                                                                                                                                                                                                             
                    "ranges": [{                                                                                                                                                                                                                               
                        "exclude": false,                                                                                                                                                                                                                      
                        "operation": "BT",                                                                                                                                                                                                                     
                        "keyField": "DtApropriacao",                                                                                                                                                                                                           
                        "value1": lowValue,                                                                                                                                                                                                                    
                        "value2": highValue                                                                                                                                                                                                                    
                    }]                                                                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            };                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            //Set SmartFilterBar initial values                                                                                                                                                                                                                
            oGlobalFilter.setFilterData(oDefaultFilter);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            //In case you want to hide a Filter                                                                                                                                                                                                                
            //oGlobalFilter.determineFilterItemByName("company_code").setVisibleInFilterBar(false);                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
        uploadFile: function (oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            var that = this;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                                     
            =================================================================== */                                                                                                                                                                             
            var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                             
                contentWidth: "300px",                                                                                                                                                                                                                         
                resizable: true,                                                                                                                                                                                                                               
                type: "Message",                                                                                                                                                                                                                               
                escapeHandler: function (oPromise) {                                                                                                                                                                                                           
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    oUploadDialog.destroy();                                                                                                                                                                                                                   
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
            oUploadDialog.setTitle("Carregar arquivo");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Define o serviço gateway que será chamado                                                                                                                                                                                                          
            =================================================================== */                                                                                                                                                                             
            var sServiceUrl = "/sap/opu/odata/SAP/ZCA_TIMESHEET_SRV/";                                                                                                                                                                                         
            var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, false);                                                                                                                                                                                
            var sSource = sServiceUrl + "uploadFileSet";                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Prepara o responsável pela carga do arquivo                                                                                                                                                                                                        
            =================================================================== */                                                                                                                                                                             
            var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                              
                width: "100%",                                                                                                                                                                                                                                 
                fileType: ["xlsx", "xls"],                                                                                                                                                                                                                     
                typeMissmatch: this.handleTypeMissmatch,                                                                                                                                                                                                       
                uploadComplete: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    oUploadDialog.destroy();                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    // Atualiza tabela do relatório após carga&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                         
                    this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    // Verifica o retorno da mensagem                                                                                                                                                                                                          
                    if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                                  
                        oEvent.mParameters.status == '201') {                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show("Carga realizada com sucesso.");                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                    else {                                                                                                                                                                                                                                     
                        if (oEvent.mParameters.response) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            if (oEvent.mParameters.responseRaw.search("<message>")) {                                                                                                                                                                          
                                var sResponse = oEvent.mParameters.responseRaw.split("<message>")[1].split("</message>")[0];                                                                                                                                   
                                alert(sResponse);                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert("Return Code: " + oEvent.mParameters.response, "Response", "Response");                                                                                                                                                  
                            }                                                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
           Define parâmetros                                                                                                                                                                                                                                   
            =================================================================== */                                                                                                                                                                             
            oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                          
            oFileUploader.setUploadUrl(sSource);                                                                                                                                                                                                               
            oFileUploader.setSendXHR(true);                                                                                                                                                                                                                    
            oFileUploader.setUseMultipart(false);                                                                                                                                                                                                              
            oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                            
                name: "x-csrf-token",                                                                                                                                                                                                                          
                value: oModel.getSecurityToken()                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            oFileUploader.insertHeaderParameter(oToken);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Cria botão para a carga do arquivo                                                                                                                                                                                                                 
            =================================================================== */                                                                                                                                                                             
            var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                            
                text: 'Upload',                                                                                                                                                                                                                                
                type: 'Accept',                                                                                                                                                                                                                                
                press: function () {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    // Verifica se arquivo foi informado                                                                                                                                                                                                       
                    var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                               
                    var file = domRef.files[0];                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    if (oFileUploader.getValue() === '') {                                                                                                                                                                                                     
                        sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                                
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                              
                        name: "Content-Type",                                                                                                                                                                                                                  
                        value: file.type                                                                                                                                                                                                                       
                    });                                                                                                                                                                                                                                        
                    oFileUploader.insertHeaderParameter(oContentType);                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                             
                        name: "SLUG",                                                                                                                                                                                                                          
                        value: oFileUploader.getValue()                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oFileUploader.upload();                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Cria botão de cancelar                                                                                                                                                                                                                             
            =================================================================== */                                                                                                                                                                             
            var oCancelButton = new sap.m.Button({                                                                                                                                                                                                             
                text: 'Cancelar',                                                                                                                                                                                                                              
                type: 'Reject',                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                press: function () {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    oUploadDialog.destroy();                                                                                                                                                                                                                   
                    this.getView().removeAllDependents();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                          
            =================================================================== */                                                                                                                                                                             
            oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                           
            oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                       
            oUploadDialog.setEndButton(oTriggerButton);                                                                                                                                                                                                        
            oUploadDialog.open();                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        handleTypeMissmatch: function (oEvent) {                                                                                                                                                                                                               
            var aFileTypes = oEvent.getSource().getFileType();                                                                                                                                                                                                 
            jQuery.each(aFileTypes, function (key, value) { aFileTypes[key] = "*." + value; });                                                                                                                                                                
            var sSupportedFileTypes = aFileTypes.join(", ");                                                                                                                                                                                                   
            sap.m.MessageToast.show("Tipo de arquivo *." + oEvent.getParameter("fileType") +                                                                                                                                                                   
                " não é suportado. Escolha um dos tipos a seguir: " +                                                                                                                                                                                          
                sSupportedFileTypes);                                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
        navegar: function (oEvent) {                                                                                                                                                                                                                           
            /* ===================================================================                                                                                                                                                                             
                Recupera dados dos campos das linhas selecionadas                                                                                                                                                                                              
            =================================================================== */                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            var filters = this.getView().byId("listReportFilter").getFilterData();                                                                                                                                                                             
            var oItemContrato = filters.Contrato;                                                                                                                                                                                                              
            var oItemTarefa = filters.Tarefa;                                                                                                                                                                                                                  
            var oItemUsuario = filters.Usuario;                                                                                                                                                                                                                
            var contrato = [];                                                                                                                                                                                                                                 
            var tarefa = [];                                                                                                                                                                                                                                   
            var usuario = [];                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            if(oItemContrato != null && oItemContrato != 'undefined')&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                        
            {                                                                                                                                                                                                                                                  
                for (let i = 0; i < oItemContrato.items.length; i++) {                                                                                                                                                                                         
                    contrato[i] = oItemContrato.items[i].key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                          
                }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                              
            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                    
                                                                                                                                                                                                                                                               
            if(oItemTarefa != null && oItemTarefa != 'undefined')&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                
            {                                                                                                                                                                                                                                                  
                for (let i = 0; i < oItemTarefa.items.length; i++) {                                                                                                                                                                                           
                    tarefa[i] = oItemTarefa.items[i].key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                              
                }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                              
            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                        
                                                                                                                                                                                                                                                               
            if(oItemUsuario != null && oItemUsuario != 'undefined')                                                                                                                                                                                            
            {                                                                                                                                                                                                                                                  
                for (let i = 0; i < oItemUsuario.items.length; i++) {                                                                                                                                                                                          
                    usuario[i] = oItemUsuario.items[i].key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                            
                }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                  
            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            /* ===================================================================                                                                                                                                                                             
            Verifica se usuário tem permissão para navegação                                                                                                                                                                                                   
            =================================================================== */                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                              
                { target: { shellHash: "timesheet_res-display" } }                                                                                                                                                                                             
            ]).done(function (aResponse) {                                                                                                                                                                                                                     
                aResponse.map(function (elem, index) {                                                                                                                                                                                                         
                    if (elem.supported === true) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        /* ===================================================================                                                                                                                                                                 
                        Chama outro aplicativo                                                                                                                                                                                                                 
                        =================================================================== */                                                                                                                                                                 
                        var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                           
                            sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                                    
                                target: { semanticObject: "timesheet_res", action: "display" },                                                                                                                                                                
                                params: {                                                                                                                                                                                                                      
                                    Contrato: contrato,                                                                                                                                                                                                        
                                    Tarefa: tarefa,                                                                                                                                                                                                            
                                    Usuario: usuario                                                                                                                                                                                                           
                                },                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                            }));                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                    else {                                                                                                                                                                                                                                     
                        alert('Usuário sem permissão para acessar o link');                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
                .fail(function () {                                                                                                                                                                                                                            
                    alert('Falha ao acessar o link');                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
        }                                                                                                                                                                                                                                                      
    };                                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            